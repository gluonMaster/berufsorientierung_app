#:schema node_modules/wrangler/config-schema.json
name = "berufsorientierung-app"
main = ".svelte-kit/cloudflare/_worker.js"
compatibility_date = "2024-09-23"

# Node.js совместимость для QR-кодов (Buffer support)
compatibility_flags = ["nodejs_compat"]

# Статические файлы
[assets]
directory = ".svelte-kit/cloudflare/assets"
binding = "ASSETS"

# Переменные окружения (не чувствительные данные)
[vars]
EMAIL_PROVIDER = "resend"
EMAIL_FROM = "Berufsorientierung <Berufsorientierung@kolibri-dresden.de>"
EMAIL_REPLY_TO = "Berufsorientierung <Berufsorientierung@kolibri-dresden.de>"
# ВАЖНО: в production лучше хранить RESEND_API_KEY только как secret (wrangler secret put RESEND_API_KEY),
# но для локальной отладки допустимо задать его как обычную переменную окружения.
# Консервативные значения для батчинга (50 писем с паузой 1 минута)
EMAIL_BULK_CHUNK = "50"
EMAIL_BULK_PAUSE_MS = "60000"
TURNSTILE_SITE_KEY = "0x****************"  # <-- Вставьте ваш Site Key

# D1 База данных (заполните после создания БД)
[[d1_databases]]
binding = "DB"
database_name = "berufsorientierung-db"
database_id = "8924cd4b-****-****-****-*************"

# R2 Storage для QR-кодов (заполните после создания bucket)
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "berufsorientierung-qr-codes"
preview_bucket_name = "berufsorientierung-qr-codes-preview"

# Cron триггер для автоматического удаления профилей (выполняется каждый день в 02:00 UTC)
[triggers]
crons = ["0 2 * * *"]

# Секреты (устанавливаются через wrangler secret put)
# JWT_SECRET
# DKIM_DOMAIN
# DKIM_SELECTOR
# DKIM_PRIVATE_KEY
# R2_PUBLIC_URL
# DATABASE_ID
# SETUP_TOKEN
# CRON_SECRET
