# MailChannels Email Configuration

## –û–±–∑–æ—Ä

Berufsorientierung –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **MailChannels** –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email —á–µ—Ä–µ–∑ Cloudflare Workers.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑ Workers
- ‚úÖ HTTP API (–±–µ–∑ SMTP)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DKIM –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ –í—ã—Å–æ–∫–∞—è deliverability –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ DNS

---

## 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –∑–∞–ø–∏—Å–µ–π

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π deliverability email –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **SPF**, **DKIM** –∏ **DMARC** –∑–∞–ø–∏—Å–∏ –≤ DNS –¥–æ–º–µ–Ω–∞.

### üìã –¢—Ä–µ–±—É–µ–º—ã–µ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞ `kolibri-dresden.de`

#### 1.1 SPF (Sender Policy Framework)

**–¢–∏–ø:** TXT  
**–ò–º—è:** `@` (–∏–ª–∏ `kolibri-dresden.de`)  
**–ó–Ω–∞—á–µ–Ω–∏–µ:**

```
v=spf1 a mx include:relay.mailchannels.net ~all
```

**–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**

- –†–∞–∑—Ä–µ—à–∞–µ—Ç MailChannels –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–∏—Å—å–º–∞ –æ—Ç –∏–º–µ–Ω–∏ –¥–æ–º–µ–Ω–∞
- `~all` = soft fail (–ø–∏—Å—å–º–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç, –Ω–æ –º–æ–≥—É—Ç –ø–æ–ø–∞—Å—Ç—å –≤ —Å–ø–∞–º –±–µ–∑ –¥—Ä—É–≥–∏—Ö –º–µ—Ä)

---

#### 1.2 DKIM (DomainKeys Identified Mail)

**–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OpenSSL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ (2048 –±–∏—Ç)
openssl genrsa -out dkim_private.key 2048

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
openssl rsa -in dkim_private.key -pubout -out dkim_public.key
```

**–®–∞–≥ 2: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è DNS**

```bash
# –£–¥–∞–ª–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
grep -v "PUBLIC KEY" dkim_public.key | tr -d '\n'
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

```
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...–æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å –∫–ª—é—á–∞...
```

**–®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ DNS –∑–∞–ø–∏—Å–∏**

**–¢–∏–ø:** TXT  
**–ò–º—è:** `mailchannels._domainkey` (selector = `mailchannels`)  
**–ó–Ω–∞—á–µ–Ω–∏–µ:**

```
v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...–≤–∞—à_–ø—É–±–ª–∏—á–Ω—ã–π_–∫–ª—é—á...
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ DNS –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–∫–ª—é—á–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–∞–≤—ã—á–∫–∏.

**–®–∞–≥ 4: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –≤ .env**

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `dkim_private.key` (–≤–∫–ª—é—á–∞—è `-----BEGIN PRIVATE KEY-----` –∏ `-----END PRIVATE KEY-----`) –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```bash
DKIM_DOMAIN=kolibri-dresden.de
DKIM_SELECTOR=mailchannels
DKIM_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...
...–≤–∞—à_–ø—Ä–∏–≤–∞—Ç–Ω—ã–π_–∫–ª—é—á...
-----END PRIVATE KEY-----"
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- –ó–∞–º–µ–Ω–∏—Ç–µ `\n` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å (–æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç)
- **–ù–ï –ö–û–ú–ú–ò–¢–¨–¢–ï** `.env` —Ñ–∞–π–ª –≤ Git!

---

#### 1.3 DMARC (Domain-based Message Authentication)

**–¢–∏–ø:** TXT  
**–ò–º—è:** `_dmarc`  
**–ó–Ω–∞—á–µ–Ω–∏–µ:**

```
v=DMARC1; p=quarantine; rua=mailto:dmarc@kolibri-dresden.de; ruf=mailto:dmarc@kolibri-dresden.de; fo=1
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `p=quarantine` - –ø–∏—Å—å–º–∞ –±–µ–∑ DKIM/SPF –ø–æ–ø–∞–¥–∞—é—Ç –≤ –∫–∞—Ä–∞–Ω—Ç–∏–Ω (spam)
- `p=reject` - (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞) –ø–∏—Å—å–º–∞ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- `rua` - email –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
- `ruf` - email –¥–ª—è forensic –æ—Ç—á—ë—Ç–æ–≤
- `fo=1` - –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç—ã –ø—Ä–∏ –ª—é–±–æ–º —Å–±–æ–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–Ω–∏—Ç–µ —Å `p=none` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `p=quarantine` –∏–ª–∏ `p=reject`.

---

## 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS

### 2.1 –û–Ω–ª–∞–π–Ω –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- **SPF –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://mxtoolbox.com/spf.aspx
- **DKIM –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://mxtoolbox.com/dkim.aspx
- **DMARC –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://mxtoolbox.com/dmarc.aspx
- **–û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://www.mail-tester.com/

### 2.2 –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (Linux/Mac)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SPF
dig TXT kolibri-dresden.de +short

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DKIM
dig TXT mailchannels._domainkey.kolibri-dresden.de +short

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DMARC
dig TXT _dmarc.kolibri-dresden.de +short
```

### 2.3 Windows PowerShell

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SPF
Resolve-DnsName -Name kolibri-dresden.de -Type TXT

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DKIM
Resolve-DnsName -Name mailchannels._domainkey.kolibri-dresden.de -Type TXT

# –ü—Ä–æ–≤–µ—Ä–∫–∞ DMARC
Resolve-DnsName -Name _dmarc.kolibri-dresden.de -Type TXT
```

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Environment Variables

### 3.1 –ü–æ—á–µ–º—É env - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä?

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Node.js, –≥–¥–µ –µ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π `process.env`, **Cloudflare Workers** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç environment variables —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞ (`platform.env` –≤ SvelteKit).

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —è–≤–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ env:**

- ‚úÖ **–ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - –Ω–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –ø–µ—Ä–µ–¥–∞—Ç—å mock env –≤ unit-—Ç–µ—Å—Ç–∞—Ö
- ‚úÖ **–ü–æ—Ä—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º Workers –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- ‚úÖ **Type Safety** - TypeScript –∑–Ω–∞–µ—Ç —Ç–æ—á–Ω—ã–π —Ç–∏–ø env
- ‚úÖ **Workers Best Practice** - —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ Cloudflare

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```typescript
import { sendEmail } from '$lib/server/email';
import type { RequestEvent } from '@sveltejs/kit';

export async function POST({ platform }: RequestEvent) {
	// platform.env –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–ø—Ä–æ—Å–∞
	await sendEmail(
		'user@example.com',
		'Test',
		'Hello!',
		platform!.env // –Ø–≤–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ env
	);
}
```

### 3.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ wrangler.toml

–í Cloudflare Workers Dashboard –∏–ª–∏ —á–µ—Ä–µ–∑ `wrangler.toml`:

```toml
[vars]
EMAIL_PROVIDER = "mailchannels"
EMAIL_FROM = "Berufsorientierung <Berufsorientierung@kolibri-dresden.de>"
EMAIL_REPLY_TO = "Berufsorientierung@kolibri-dresden.de"
# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
EMAIL_BULK_CHUNK = "50"
EMAIL_BULK_PAUSE_MS = "60000"
DKIM_DOMAIN = "kolibri-dresden.de"
DKIM_SELECTOR = "mailchannels"

# DKIM_PRIVATE_KEY –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ —Å–µ–∫—Ä–µ—Ç—ã (secrets)
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ —á–µ—Ä–µ–∑ Wrangler:**

```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ DKIM –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∫–∞–∫ —Å–µ–∫—Ä–µ—Ç
wrangler secret put DKIM_PRIVATE_KEY

# –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ dkim_private.key (–≤–∫–ª—é—á–∞—è –∑–∞–≥–æ–ª–æ–≤–∫–∏)
```

---

## 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ email

### 4.1 –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π endpoint –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π:

```typescript
import { sendEmail } from '$lib/server/email';

// –í API route
export async function POST({ platform }) {
	try {
		await sendEmail(
			'your-test-email@example.com',
			'Test Email',
			'This is a test email from Berufsorientierung',
			platform!.env
		);

		return json({ success: true });
	} catch (error) {
		console.error(error);
		return json({ success: false, error: String(error) }, { status: 500 });
	}
}
```

### 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ deliverability

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –Ω–∞:

- https://www.mail-tester.com/ (–ø–æ–ª—É—á–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å)
- –í–∞—à –ª–∏—á–Ω—ã–π email

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç mail-tester:**

- ‚úÖ SPF alignment
- ‚úÖ DKIM signature
- ‚úÖ DMARC policy
- ‚úÖ Spam score
- ‚úÖ Blacklist status

**–¶–µ–ª–µ–≤–æ–π –±–∞–ª–ª:** 10/10

---

## 5. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º (Troubleshooting)

### 5.1 –ü–∏—Å—å–º–∞ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:** Email –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ inbox

**–†–µ—à–µ–Ω–∏—è:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É Spam/Junk
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ (SPF, DKIM, DMARC)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Cloudflare Workers
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ mail-tester.com –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
5. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω –Ω–µ –≤ blacklist: https://mxtoolbox.com/blacklists.aspx

### 5.2 DKIM signature –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É

**–ü—Ä–æ–±–ª–µ–º–∞:** DKIM verification failed

**–†–µ—à–µ–Ω–∏—è:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ DNS –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤/–ø–µ—Ä–µ–Ω–æ—Å–æ–≤)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ selector –≤ DNS –∏ –≤ `.env` —Å–æ–≤–ø–∞–¥–∞—é—Ç (`mailchannels`)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ `-----BEGIN/END-----`
4. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 24-48 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è DNS (TTL propagation)

### 5.3 MailChannels API –æ—à–∏–±–∫–∏

**–û—à–∏–±–∫–∞ 401 Unauthorized:**

- MailChannels –Ω–µ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á–∞ –¥–ª—è Workers
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∏–¥—ë—Ç –∏–º–µ–Ω–Ω–æ –∏–∑ Cloudflare Workers environment

**–û—à–∏–±–∫–∞ 400 Bad Request:**

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç payload (—Å–º. `src/lib/server/email/index.ts`)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ email –∞–¥—Ä–µ—Å–∞ –≤–∞–ª–∏–¥–Ω—ã

**–û—à–∏–±–∫–∞ 429 Rate Limit:**

- –£–º–µ–Ω—å—à–∏—Ç–µ `EMAIL_BULK_CHUNK`
- –£–≤–µ–ª–∏—á—å—Ç–µ `EMAIL_BULK_PAUSE_MS`

### 5.4 –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–∞—è

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ - —ç—Ç–æ **—Ñ–∏—á–∞, –∞ –Ω–µ –±–∞–≥**! –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (50 –ø–∏—Å–µ–º —Å –ø–∞—É–∑–æ–π 1 –º–∏–Ω—É—Ç–∞) –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ blacklist.

**–ï—Å–ª–∏ –≤—Å—ë –∂–µ –Ω—É–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å:**

- –£–≤–µ–ª–∏—á—å—Ç–µ `EMAIL_BULK_CHUNK` –¥–æ 100-150 (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
- –£–º–µ–Ω—å—à–∏—Ç–µ `EMAIL_BULK_PAUSE_MS` –¥–æ 30000-45000ms (–Ω–µ –º–µ–Ω–µ–µ 30 —Å–µ–∫—É–Ω–¥!)
- ‚ùå **–ù–ï —É–º–µ–Ω—å—à–∞–π—Ç–µ** –ø–∞—É–∑—É –Ω–∏–∂–µ 30 —Å–µ–∫—É–Ω–¥ - —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Cloudflare Queues –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏:**

```
1000 –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (50/60000):
- 20 –±–∞—Ç—á–µ–π √ó 60 —Å–µ–∫—É–Ω–¥ = ~20 –º–∏–Ω—É—Ç
- –≠—Ç–æ –ù–û–†–ú–ê–õ–¨–ù–û –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏!
```

**üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –º–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ Cron Job –≤ –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞.

---

## 6. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### 6.1 Reply-To –∞–¥—Ä–µ—Å

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å:

```bash
EMAIL_REPLY_TO=support@kolibri-dresden.de
```

### 6.2 –ú—É–ª—å—Ç–∏–¥–æ–º–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤:

1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SPF/DKIM –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞
2. –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ DKIM –∫–ª—é—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞
3. –í —Ñ—É–Ω–∫—Ü–∏–∏ `sendEmail()` –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 7.1 –ó–∞—â–∏—Ç–∞ DKIM –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞

- ‚ùå **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ** `.env` —Ñ–∞–π–ª –≤ Git
- ‚ùå **–ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ** –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cloudflare Workers Secrets –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- ‚úÖ –î–æ–±–∞–≤—å—Ç–µ `.env` –≤ `.gitignore`

### 7.2 Rate Limiting

MailChannels –Ω–µ –ø—É–±–ª–∏–∫—É–µ—Ç —á—ë—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

- **50 –ø–∏—Å–µ–º –Ω–∞ –±–∞—Ç—á** (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ)
- **–ü–∞—É–∑–∞ 1 –º–∏–Ω—É—Ç–∞** –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏ (–º–∏–Ω–∏–º—É–º 30 —Å–µ–∫—É–Ω–¥)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ 429 (Too Many Requests)

**–ü–æ—á–µ–º—É —Ç–∞–∫–∏–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã?**

- –ù–æ–≤—ã–π –¥–æ–º–µ–Ω –±–µ–∑ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –¥–æ–º–µ–Ω–∞
- Email –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Gmail, Outlook) –º–æ–Ω–∏—Ç–æ—Ä—è—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–ø–∞–º–∞
- –õ—É—á—à–µ –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ, —á–µ–º –±—ã—Å—Ç—Ä–æ –∏ –≤ blacklist

---

## 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 8.1 Cloudflare Workers Logs

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```bash
wrangler tail
```

### 8.2 DMARC –æ—Ç—á—ë—Ç—ã

–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ DMARC –æ—Ç—á—ë—Ç—ã –Ω–∞ `rua` –∞–¥—Ä–µ—Å–µ –¥–ª—è:

- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ñ–∏—à–∏–Ω–≥–∞/—Å–ø—É—Ñ–∏–Ω–≥–∞
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ deliverability
- –í—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π

### 8.3 Application Logs

–í—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:

```
[Email] Successfully sent to: user@example.com
[Email Bulk] Starting bulk send: { totalRecipients: 150, chunkSize: 100 }
[Email Bulk] Chunk 1/2 completed: { success: 98, failed: 2 }
```

---

## 9. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

–ï—Å–ª–∏ MailChannels –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

- **Resend** (https://resend.com) - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π API, —Ö–æ—Ä–æ—à–∞—è deliverability
- **SendGrid** (https://sendgrid.com) - –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å
- **Postmark** (https://postmarkapp.com) - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ transactional emails

**–î–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**

1. –û–±–Ω–æ–≤–∏—Ç–µ `EMAIL_PROVIDER` –≤ `.env`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–¥–∞–ø—Ç–µ—Ä –≤ `src/lib/server/email/index.ts`

---

## 10. –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **MailChannels Docs:** https://mailchannels.zendesk.com/hc/en-us
- **Cloudflare Workers Email:** https://developers.cloudflare.com/workers/runtime-apis/email/
- **SPF –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://www.spf-record.com/
- **DKIM –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://dkimcore.org/tools/
- **DMARC –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://dmarc.org/resources/deployment-tools/

---

## Changelog

**2025-10-24:**

- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ MailChannels
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ SPF, DKIM, DMARC
- ‚úÖ –û–ø–∏—Å–∞–Ω—ã –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ troubleshooting
