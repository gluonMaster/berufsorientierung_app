# Cloudflare Cron Triggers - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼ĞµÑ€Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ğ¹

Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Cron Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (GDPR) Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸ÑÑ‚Ñ‘ĞºÑˆĞ¸Ñ… Ğ´ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¾Ğ² Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ğ¼ĞµÑ€Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ñ.

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

- [ĞĞ±Ğ·Ğ¾Ñ€](#Ğ¾Ğ±Ğ·Ğ¾Ñ€)
- [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
- [Endpoints](#endpoints)
- [ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°](#Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°)
- [Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
- [Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ](#Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
- [ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³](#Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³)
- [Troubleshooting](#troubleshooting)

## ĞĞ±Ğ·Ğ¾Ñ€

ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ´Ğ»Ñ:

1. **Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹** Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğ¸ Ñ GDPR
2. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¸ÑÑ‚Ñ‘ĞºÑˆĞ¸Ñ… Ğ´ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¾Ğ²** Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ° Ğ¼ĞµÑ€Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ñ

Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ÑÑ‚ÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 02:00 UTC Ñ‡ĞµÑ€ĞµĞ· Cloudflare Cron Triggers.

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

- âœ… **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹** Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ
- âœ… **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ÑÑ‚Ñ‘ĞºÑˆĞ¸Ñ… Ğ´ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¾Ğ²** Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
- âœ… **Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº** Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² (Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ°)
- âœ… **Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ¼** (CRON_SECRET) Ğ¾Ñ‚ Ğ½ĞµÑĞ°Ğ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ²
- âœ… **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** Ğ²ÑĞµÑ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- âœ… **GDPR compliance** (Ğ°Ñ€Ñ…Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ Scheduled Handler (Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Cloudflare Cron)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare Cron                         â”‚
â”‚              Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: 0 2 * * *                         â”‚
â”‚            (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 02:00 UTC)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Ğ’Ñ‹Ğ·Ğ¾Ğ² scheduled() Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ (Ğ±ĞµĞ· HTTP)
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        src/worker.ts - scheduled()                         â”‚
â”‚                                                             â”‚
â”‚  1. DB.gdpr.processScheduledDeletions()                    â”‚
â”‚  2. DB.events.closeExpiredRegistrations()                  â”‚
â”‚  3. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² activity_log                             â”‚
â”‚  4. Console logging                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ ĞĞ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare D1                            â”‚
â”‚                                                             â”‚
â”‚  â€¢ pending_deletions - Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ            â”‚
â”‚  â€¢ users - Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸                                     â”‚
â”‚  â€¢ deleted_users_archive - Ğ°Ñ€Ñ…Ğ¸Ğ² ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ñ…                 â”‚
â”‚  â€¢ activity_log - Ğ»Ğ¾Ğ³Ğ¸ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**

- âœ… ĞĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Cloudflare Workers
- âœ… ĞĞµ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- âœ… Ğ‘Ğ¾Ğ»ĞµĞµ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾ (Ğ½ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ ÑĞµÑ‚Ğ¸)
- âœ… Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ (Ğ½Ğµ Ñ€Ğ°ÑÑ…Ğ¾Ğ´ÑƒĞµÑ‚ request quota)

**ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚ĞºĞ¸:**

- âš ï¸ Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ SvelteKit build Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ¼
- âš ï¸ Ğ¡Ğ»Ğ¾Ğ¶Ğ½ĞµĞµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾

---

### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: HTTP Endpoint + Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Cron ÑĞµÑ€Ğ²Ğ¸Ñ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Cron ÑĞµÑ€Ğ²Ğ¸Ñ                             â”‚
â”‚        (cron-job.org, GitHub Actions, etc.)                â”‚
â”‚              Ğ Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ: 0 2 * * *                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ GET Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ Authorization header
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        GET /api/cron/delete-users                          â”‚
â”‚                                                             â”‚
â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° CRON_SECRET                                   â”‚
â”‚  2. DB.gdpr.processScheduledDeletions()                    â”‚
â”‚  3. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² activity_log                             â”‚
â”‚  4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ ĞĞ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Cloudflare D1                            â”‚
â”‚                                                             â”‚
â”‚  â€¢ pending_deletions - Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ            â”‚
â”‚  â€¢ users - Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸                                     â”‚
â”‚  â€¢ deleted_users_archive - Ğ°Ñ€Ñ…Ğ¸Ğ² ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½Ğ½Ñ‹Ñ…                 â”‚
â”‚  â€¢ activity_log - Ğ»Ğ¾Ğ³Ğ¸ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ (Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ POST Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· JWT)
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     POST /api/admin/cron/trigger-delete                    â”‚
â”‚                                                             â”‚
â”‚  1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° admin Ğ¿Ñ€Ğ°Ğ²                                    â”‚
â”‚  2. DB.gdpr.processScheduledDeletions()                    â”‚
â”‚  3. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² activity_log                             â”‚
â”‚  4. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Endpoints

### 1. ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Cron endpoint

**URL:** `GET /api/cron/delete-users`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Cloudflare Cron. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚:

- Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸Ğ· `pending_deletions`
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ Ğ¼ĞµÑ€Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ¸Ğ¹ Ñ Ğ¸ÑÑ‚Ñ‘ĞºÑˆĞ¸Ğ¼ Ğ´ĞµĞ´Ğ»Ğ°Ğ¹Ğ½Ğ¾Ğ¼ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸

**Authentication:** Bearer Token (CRON_SECRET)

**Headers:**

```
Authorization: Bearer <CRON_SECRET>
```

**Response (Success):**

```json
{
	"success": true,
	"deleted": 3,
	"expiredRegistrations": 2,
	"message": "Successfully deleted 3 user(s), found 2 event(s) with expired deadline",
	"timestamp": "2025-11-12T02:00:15.000Z"
}
```

**Response (Error - Unauthorized):**

```json
{
	"success": false,
	"error": "Invalid authorization token"
}
```

**Status Codes:**

- `200 OK` - ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
- `401 Unauthorized` - ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ CRON_SECRET
- `500 Internal Server Error` - ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸

**Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```json
{
	"user_id": null,
	"action_type": "system_cron_deletion",
	"details": {
		"deleted_count": 3,
		"expired_registrations_count": 2,
		"triggered_by": "cloudflare_cron",
		"cron_schedule": "0 2 * * *"
	},
	"ip_address": null,
	"timestamp": "2025-11-12T02:00:15.000Z"
}
```

---

### 2. Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ endpoint Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²

**URL:** `POST /api/admin/cron/trigger-delete`

**ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ:** Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²).

**Authentication:** JWT Token Ğ² Cookie

**Headers:**

```
Cookie: auth_token=<JWT_TOKEN>
```

**Response (Success):**

```json
{
	"success": true,
	"deleted": 2,
	"message": "Successfully deleted 2 user(s)",
	"timestamp": "2025-11-12T14:30:00.000Z"
}
```

**Response (Error - Unauthorized):**

```json
{
	"success": false,
	"error": "Unauthorized"
}
```

**Status Codes:**

- `200 OK` - Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
- `401 Unauthorized` - ĞĞµ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½ Ğ¸Ğ»Ğ¸ Ğ½Ğµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼
- `500 Internal Server Error` - ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸

**Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```json
{
	"user_id": 1,
	"action_type": "system_cron_deletion",
	"details": {
		"deleted_count": 2,
		"triggered_by": "manual_admin",
		"admin_id": 1
	},
	"ip_address": "192.168.1.100",
	"timestamp": "2025-11-12T14:30:00.000Z"
}
```

## ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

### 1. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ CRON_SECRET

```bash
# Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½ (32 Ğ±Ğ°Ğ¹Ñ‚Ğ°)
openssl rand -base64 32

# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°:
# Xk8vQ2m5N7pL9wR3tY6uZ1aS4dF7gH0j
```

### 2. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑĞµĞºÑ€ĞµÑ‚Ğ° Ğ² Cloudflare

**Ğ§ĞµÑ€ĞµĞ· Wrangler CLI:**

```bash
wrangler secret put CRON_SECRET
# Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Enter
```

**Ğ§ĞµÑ€ĞµĞ· Cloudflare Dashboard:**

1. ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² **Workers & Pages**
2. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ğ°ÑˆĞµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
3. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ²ĞºĞ»Ğ°Ğ´ĞºÑƒ **Settings** â†’ **Variables**
4. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ **Add variable**
5. Name: `CRON_SECRET`
6. Value: Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½
7. Type: **Secret** (Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ)
8. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ **Save**

### 3. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Cron Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ

**wrangler.toml** ÑƒĞ¶Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:

```toml
[triggers]
crons = ["0 2 * * *"]  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 02:00 UTC
```

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ A: Ğ’ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ Scheduled Handler (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ production)

**Ğ¤Ğ°Ğ¹Ğ»Ñ‹:**

- `src/worker.ts` - ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº `scheduled()` Ğ´Ğ»Ñ Cloudflare Cron
- `src/entry-worker.ts` - Entry point, Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑÑÑ‰Ğ¸Ğ¹ SvelteKit Ğ¸ Cron

**ĞŸĞ¾ÑĞ»Ğµ Ğ´ĞµĞ¿Ğ»Ğ¾Ñ Cloudflare Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ `scheduled()` Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ.**

**âš ï¸ Ğ’Ğ°Ğ¶Ğ½Ğ¾:** SvelteKit Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ `.svelte-kit/cloudflare/_worker.js` Ğ¿Ñ€Ğ¸ build. Ğ”Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ `scheduled` handler Ğ½ÑƒĞ¶ĞµĞ½ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ· Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¾Ğ²:

**ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ 1: Post-build script (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹)**

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ `scripts/inject-cron.js`:

```javascript
import { readFileSync, writeFileSync } from 'fs';

// Ğ§Ğ¸Ñ‚Ğ°ĞµĞ¼ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ SvelteKit worker
const workerPath = '.svelte-kit/cloudflare/_worker.js';
let workerCode = readFileSync(workerPath, 'utf-8');

// Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ export scheduled Ğ² ĞºĞ¾Ğ½ĞµÑ† Ñ„Ğ°Ğ¹Ğ»Ğ°
const scheduledExport = `
// Cloudflare Cron Handler (injected by build script)
export { scheduled } from '../../src/worker.ts';
`;

workerCode += scheduledExport;
writeFileSync(workerPath, workerCode);
console.log('âœ… Injected scheduled handler into worker');
```

ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ `package.json`:

```json
{
	"scripts": {
		"build": "vite build && node scripts/inject-cron.js",
		"deploy": "npm run build && wrangler deploy"
	}
}
```

**ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´ 2: Ğ ÑƒÑ‡Ğ½Ğ°Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ**

ĞŸĞ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ `npm run build` Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² ĞºĞ¾Ğ½ĞµÑ† `.svelte-kit/cloudflare/_worker.js`:

```javascript
export { scheduled } from '../../src/worker.ts';
```

---

#### Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ B: Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Cron ÑĞµÑ€Ğ²Ğ¸Ñ (Ğ¿Ñ€Ğ¾Ñ‰Ğµ Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ HTTP endpoint `/api/cron/delete-users` Ñ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ Cron ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ¼.**

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ B1: cron-job.org (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾)**

1. Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ Ğ½Ğ° https://cron-job.org
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Cron Job:
   - **Title:** "Berufsorientierung User Deletion"
   - **URL:** `https://your-app.workers.dev/api/cron/delete-users`
   - **HTTP Method:** GET
   - **Custom Headers:**
     ```
     Authorization: Bearer YOUR_CRON_SECRET
     ```
   - **Schedule:**
     - Minute: 0
     - Hour: 2
     - Day: \*
     - Month: \*
     - Weekday: \*
   - **Timezone:** UTC
3. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ **Create Cronjob**

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ B: EasyCron (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ğ½ - 20 cron jobs)**

1. Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ Ğ½Ğ° https://www.easycron.com
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Cron Job:
   - **Cron Expression:** `0 2 * * *`
   - **URL:** `https://your-app.workers.dev/api/cron/delete-users`
   - **HTTP Method:** GET
   - **HTTP Headers:**
     ```
     Authorization: Bearer YOUR_CRON_SECRET
     ```
3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ C: GitHub Actions (Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸ĞµĞ²)**

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ„Ğ°Ğ¹Ğ» `.github/workflows/cron-delete-users.yml`:

```yaml
name: Scheduled User Deletion

on:
  schedule:
    - cron: '0 2 * * *' # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 02:00 UTC
  workflow_dispatch: # Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°

jobs:
  delete-users:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger deletion endpoint
        run: |
          curl -X GET \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            https://your-app.workers.dev/api/cron/delete-users
```

Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ `CRON_SECRET` Ğ² **GitHub Secrets** (Settings â†’ Secrets and variables â†’ Actions).

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° endpoint

1. **Bearer Token Authentication:**
   - Endpoint `/api/cron/delete-users` Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº `Authorization: Bearer <CRON_SECRET>`
   - Ğ¢Ğ¾ĞºĞµĞ½ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ»ÑƒÑ‡Ğ°Ğ¹Ğ½Ñ‹Ğ¼ Ğ¸ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑÑ‚Ğ¾Ğ¹ĞºĞ¸Ğ¼ (Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 32 Ğ±Ğ°Ğ¹Ñ‚Ğ°)
   - Ğ¢Ğ¾ĞºĞµĞ½ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ² Cloudflare Secrets (Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½)

2. **ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ:**

   ```typescript
   // Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¸Ğ· Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°
   const authHeader = request.headers.get('Authorization');
   const token = authHeader?.slice(7); // Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ "Bearer "

   // Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ ÑĞµĞºÑ€ĞµÑ‚Ğ¾Ğ¼ Ğ¸Ğ· env
   if (token !== platform?.env?.CRON_SECRET) {
   	return json({ error: 'Unauthorized' }, { status: 401 });
   }
   ```

3. **Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
   - Ğ’ÑĞµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Cron Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ² `activity_log`
   - user_id = null (ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ğ¾Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ)
   - action_type = 'system_cron_deletion'
   - IP address = null (Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ²)

### Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸

- âœ… **Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ Ñ€Ğ¾Ñ‚Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ CRON_SECRET** (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 6 Ğ¼ĞµÑÑÑ†ĞµĞ²)
- âœ… **Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ HTTPS** Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Cloudflare Workers Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸)
- âœ… **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸** Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ½ĞµÑĞ°Ğ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚Ğ¾Ğº
- âœ… **ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ÑŒÑ‚Ğµ rate limiting** Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Cloudflare (Ğ¼Ğ°ĞºÑĞ¸Ğ¼ÑƒĞ¼ 1 Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ² Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ)

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**âš ï¸ Cloudflare Cron Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ² production!**

Ğ”Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ endpoint:

```bash
# 1. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ dev ÑĞµÑ€Ğ²ĞµÑ€
npm run dev

# 2. ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ĞºĞ°Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ
# ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ http://localhost:5173/login
# Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ Ñ admin credentials

# 3. Ğ’ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ:
fetch('/api/admin/cron/trigger-delete', {
  method: 'POST',
  credentials: 'include'
})
.then(r => r.json())
.then(console.log);

# Ğ˜Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· curl (Ğ½ÑƒĞ¶ĞµĞ½ JWT Ñ‚Ğ¾ĞºĞµĞ½ Ğ¸Ğ· Cookie):
curl -X POST http://localhost:5173/api/admin/cron/trigger-delete \
  -H "Cookie: auth_token=YOUR_JWT_TOKEN"
```

### Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² production

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 1: Ğ§ĞµÑ€ĞµĞ· Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€ (Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¾Ğ²)**

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ° (F12)
2. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ:
   ```javascript
   fetch('/api/admin/cron/trigger-delete', {
   	method: 'POST',
   	credentials: 'include',
   })
   	.then((r) => r.json())
   	.then(console.log);
   ```

**Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ 2: Ğ§ĞµÑ€ĞµĞ· curl Ñ CRON_SECRET**

```bash
curl -X GET https://your-app.workers.dev/api/cron/delete-users \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

**ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**

```json
{
	"success": true,
	"deleted": 0,
	"message": "Successfully deleted 0 user(s)",
	"timestamp": "2025-11-12T14:45:00.000Z"
}
```

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ĞµĞ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ:

```sql
-- 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
INSERT INTO users (email, password_hash, first_name, last_name, birth_date, created_at, updated_at)
VALUES ('test@example.com', 'hash', 'Test', 'User', '2000-01-01', datetime('now'), datetime('now'));

-- 2. Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ (Ğ²Ñ‡ĞµÑ€Ğ°ÑˆĞ½ÑÑ Ğ´Ğ°Ñ‚Ğ°)
INSERT INTO pending_deletions (user_id, deletion_date, created_at)
VALUES (
  (SELECT id FROM users WHERE email = 'test@example.com'),
  date('now', '-1 day'),
  datetime('now')
);

-- 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½
SELECT * FROM pending_deletions;
```

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¸Ñ‚Ğµ endpoint ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑƒĞ´Ğ°Ğ»Ñ‘Ğ½.

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Cloudflare Workers

**Real-time Ğ»Ğ¾Ğ³Ğ¸:**

```bash
# Ğ’ÑĞµ Ğ»Ğ¾Ğ³Ğ¸
wrangler tail

# Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Cron ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
wrangler tail --format pretty | grep CRON

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² Ñ„Ğ°Ğ¹Ğ»
wrangler tail > logs.txt
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ°:**

```
[CRON] Starting scheduled user deletions...
[CRON] Completed. Deleted 2 user(s)
```

### ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ² Activity Log

**Ğ§ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ:**

1. ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² **Admin Panel** â†’ **Activity Logs**
2. Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ: `system_cron_deletion`
3. ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸Ñ‚Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ»Ğ¾Ğ³Ğ°

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ»Ğ¾Ğ³Ğ°:**

```json
{
	"id": 1234,
	"user_id": null,
	"action_type": "system_cron_deletion",
	"details": "{\"deleted_count\":2,\"triggered_by\":\"cloudflare_cron\",\"cron_schedule\":\"0 2 * * *\"}",
	"ip_address": null,
	"timestamp": "2025-11-12T02:00:15.000Z"
}
```

### ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ñ‡ĞµÑ€ĞµĞ· API

**ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Cron Ğ»Ğ¾Ğ³Ğ¸:**

```bash
curl -X GET "https://your-app.workers.dev/api/admin/logs?actionType=system_cron_deletion&limit=10" \
  -H "Cookie: auth_token=YOUR_JWT_TOKEN"
```

**Response:**

```json
{
	"logs": [
		{
			"id": 1234,
			"action_type": "system_cron_deletion",
			"details": "{\"deleted_count\":2,\"triggered_by\":\"cloudflare_cron\"}",
			"timestamp": "2025-11-12T02:00:15.000Z"
		}
	],
	"total": 10
}
```

### ĞĞ»ĞµÑ€Ñ‚Ñ‹ Ğ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ² Ğ² Cloudflare:**

1. ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² **Cloudflare Dashboard** â†’ **Notifications**
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ°Ğ»ĞµÑ€Ñ‚:
   - **Type:** Worker Errors
   - **Worker:** berufsorientierung-app
   - **Threshold:** > 5 errors in 5 minutes
   - **Notification:** Email/Webhook

**Webhook Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ² Slack/Discord:**

Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² ĞºĞ¾Ğ´ endpoint:

```typescript
// ĞŸĞ¾ÑĞ»Ğµ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ñ
if (deletedCount > 0) {
	await fetch('YOUR_WEBHOOK_URL', {
		method: 'POST',
		headers: { 'Content-Type': 'application/json' },
		body: JSON.stringify({
			text: `âœ… Cron deletion completed: ${deletedCount} user(s) deleted`,
		}),
	});
}
```

## Troubleshooting

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Cron Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** SvelteKit Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ÑÑ‚ Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Cron Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ñ‹ Ğ¸Ğ· `wrangler.toml`.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¹ Cron ÑĞµÑ€Ğ²Ğ¸Ñ (cron-job.org, GitHub Actions Ğ¸ Ñ‚.Ğ´.).

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: 401 Unauthorized Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ endpoint

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹:**

1. CRON_SECRET Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ² Cloudflare
2. ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½ Ğ² Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞµ Authorization
3. ĞÑ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑ "Bearer "

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:**

```bash
# 1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ»Ğ¸ ÑĞµĞºÑ€ĞµÑ‚
wrangler secret list

# 2. ĞŸĞµÑ€ĞµÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚
wrangler secret put CRON_SECRET

# 3. ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°
curl -v -X GET https://your-app.workers.dev/api/cron/delete-users \
  -H "Authorization: Bearer YOUR_CRON_SECRET"
```

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚, Ñ…Ğ¾Ñ‚Ñ endpoint Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ success

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ’ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ `pending_deletions` Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ñ Ğ´Ğ°Ñ‚Ğ¾Ğ¹ <= Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹.

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:**

```sql
-- ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ pending_deletions
SELECT * FROM pending_deletions WHERE deletion_date <= date('now');

-- ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ğ½Ğµ Ğ·Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ
SELECT id, email, is_blocked FROM users
WHERE id IN (SELECT user_id FROM pending_deletions);
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ñ‚ĞµÑÑ‚Ğ¾Ğ²ÑƒÑ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ Ñ Ğ²Ñ‡ĞµÑ€Ğ°ÑˆĞ½ĞµĞ¹ Ğ´Ğ°Ñ‚Ğ¾Ğ¹ (ÑĞ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» "Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ").

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: ĞÑˆĞ¸Ğ±ĞºĞ° "Database not available"

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… D1 Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ğ° Ğº Worker.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**

1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ `wrangler.toml`:

   ```toml
   [[d1_databases]]
   binding = "DB"
   database_name = "berufsorientierung_db"
   database_id = "YOUR_DATABASE_ID"
   ```

2. Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ±Ğ°Ğ·Ğ° ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°:

   ```bash
   wrangler d1 list
   ```

3. ĞŸĞµÑ€ĞµÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ±Ğ°Ğ·Ñƒ, ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾:
   ```bash
   wrangler d1 create berufsorientierung_db
   ```

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ¡Ğ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Cron

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Cron ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:**

1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ²ÑĞµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Cron jobs (cron-job.org, GitHub Actions Ğ¸ Ñ‚.Ğ´.)
2. ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚Ğµ Ğ´ÑƒĞ±Ğ»Ğ¸Ñ€ÑƒÑÑ‰Ğ¸ĞµÑÑ
3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Cron Ñ‚Ñ€Ğ¸Ğ³Ğ³ĞµÑ€Ğ¾Ğ²

---

### ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°: Ğ›Ğ¾Ğ³Ğ¸ Ğ½Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ² activity_log

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:** ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ `DB.activityLog.logActivity()`.

**ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:**

```bash
# ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸ Worker
wrangler tail

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
wrangler d1 execute berufsorientierung_db \
  --command "SELECT sql FROM sqlite_master WHERE name = 'activity_log';"
```

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ£Ğ±ĞµĞ´Ğ¸Ñ‚ĞµÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ñ‹:

```bash
wrangler d1 execute berufsorientierung_db --file=./migrations/0001_initial.sql
```

---

## Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

- ğŸ“š [GDPR Module Documentation](../database/gdpr/README.md)
- ğŸ“š [Activity Log Documentation](../database/activitylog/README.md)
- ğŸ“š [Cloudflare Workers Cron Triggers](https://developers.cloudflare.com/workers/configuration/cron-triggers/)
- ğŸ“š [SvelteKit on Cloudflare](https://kit.svelte.dev/docs/adapter-cloudflare)

---

**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** 2025-11-12
